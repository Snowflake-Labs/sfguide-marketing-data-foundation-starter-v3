"Set Up Snowflake":
  extends:
    - .agent_tag
  image: $DATAOPS_PYTHON3_11_RUNNER_IMAGE
  stage: "Snowflake Setup"
  variables:
    DATAOPS_SNOWFLAKE_ACCOUNT: $DATAOPS_SOLE_ACCOUNT
    DATAOPS_SNOWFLAKE_USER: $DATAOPS_SOLE_USERNAME
    DATAOPS_SNOWFLAKE_PASSWORD: $DATAOPS_SOLE_PASSWORD
  script:
    - python --version
    - curl -fsSL https://get.docker.com | sh
    - pip install jupyter
    - pip install -r solution/requirements.txt
    - pip install snowflake-cli-labs==2.2.0
    - snow connection list #(creates the ~/.config/snowflake/config.toml)
    - echo -e "[connections]\n[connections.\"default\"]\\naccount = \"$DATAOPS_SOLE_ACCOUNT\"\nuser = \"$DATAOPS_SOLE_USERNAME\"\npassword = \"$DATAOPS_SOLE_PASSWORD\"\nwarehouse = \"$DATAOPS_SOLE_WAREHOUSE\"\nrole = \"$DATAOPS_SOLE_ROLE\" \n"> /root/.config/snowflake/config.toml
    - chmod 600 /root/.config/snowflake/config.toml
    - /dataops || true
    - snow --info
    - snow connection list
    - snow connection set-default default
    - snow connection test
    - cd solution
    # - jupyter nbconvert --to notebook --execute  "Setup_Campaign_Intelligence.ipynb"  --ExecutePreprocessor.timeout=-1 --debug
    # - jupyter nbconvert --to notebook --execute  "Setup_Customer360_Starter.ipynb"  --ExecutePreprocessor.timeout=-1 --debug
    - jupyter nbconvert --to notebook --allow-errors --execute  "deployment_na_spcs.ipynb"  --ExecutePreprocessor.timeout=-1 --debug
  icon: ${PYTHON_ICON}
